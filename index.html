<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Zee Chat</title>

<style>
body {
  margin:0;
  font-family: Arial, sans-serif;
  background:#111;
  color:white;
}

/* HEADER */
header {
  background:black;
  padding:15px;
  text-align:center;
  color:#00ff66;
  font-size:22px;
  font-weight:bold;
}

/* AUTH SCREEN */
#authForms {
  padding:20px;
  text-align:center;
}

#authForms input {
  width:80%;
  padding:12px;
  margin:10px 0;
  border:none;
  border-radius:5px;
  background:#222;
  color:white;
}

#authForms button {
  width:85%;
  padding:12px;
  margin-top:10px;
  border:none;
  border-radius:5px;
  background:#00ff66;
  color:black;
  font-weight:bold;
}

/* CHAT SCREEN */
#chatInterface {
  display:none;
  height:100vh;
  display:flex;
  flex-direction:column;
}

#chatDisplay {
  flex:1;
  overflow-y:auto;
  padding:10px;
  margin-bottom:70px;
}

/* MESSAGE STYLES */
.chat-box {
  padding:8px 12px;
  margin:6px 0;
  border-radius:8px;
  max-width:70%;
  word-wrap:break-word;
}

.user1 {
  background:#00ff66;
  color:black;
  align-self:flex-start;
}

.user2 {
  background:#2196F3;
  color:white;
  align-self:flex-end;
}

/* INPUT BAR */
#chatInput {
  position:fixed;
  bottom:0;
  left:0;
  width:100%;
  display:flex;
  padding:10px;
  background:#111;
}

#chatInput input {
  flex:1;
  padding:12px;
  border:none;
  border-radius:5px;
  background:#222;
  color:white;
}

#chatInput button {
  margin-left:5px;
  padding:12px;
  border:none;
  border-radius:5px;
  background:#00ff66;
  color:black;
  font-weight:bold;
}
</style>
</head>

<body>

<header>Zee Chat</header>

<div id="authForms">
  <h3>Sign Up</h3>
  <input type="email" id="signUpEmail" placeholder="Email">
  <input type="password" id="signUpPassword" placeholder="Password">
  <button onclick="signUp()">Sign Up</button>

  <h3>Log In</h3>
  <input type="email" id="loginEmail" placeholder="Email">
  <input type="password" id="loginPassword" placeholder="Password">
  <button onclick="logIn()">Log In</button>
</div>

<div id="chatInterface">
  <div id="chatDisplay"></div>

  <div id="chatInput">
    <input type="text" id="textInput" placeholder="Type your message...">
    <button onclick="sendMessage()">Send</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyCO_Pmu6QYJWbnNvRUYyRLvi6SLIfUrtHI",
  authDomain: "zeeworldyhi.firebaseapp.com",
  databaseURL: "https://zeeworldyhi-default-rtdb.firebaseio.com/",
  projectId: "zeeworldyhi",
  storageBucket: "zeeworldyhi.appspot.com",
  messagingSenderId: "154414924399",
  appId: "1:154414924399:web:4817b6b3e7cb5f91ba439a"
};

firebase.initializeApp(firebaseConfig);

var auth = firebase.auth();
var database = firebase.database();
var currentUser;
var chatRef;

/* AUTO SWITCH SCREEN */
auth.onAuthStateChanged(function(user) {
  if (user) {
    currentUser = user;
    document.getElementById("authForms").style.display = "none";
    document.getElementById("chatInterface").style.display = "flex";
    startChat();
  } else {
    document.getElementById("authForms").style.display = "block";
    document.getElementById("chatInterface").style.display = "none";
  }
});

/* SIGN UP */
function signUp() {
  var email = document.getElementById("signUpEmail").value;
  var password = document.getElementById("signUpPassword").value;

  auth.createUserWithEmailAndPassword(email, password)
    .catch(function(error){
      alert(error.message);
    });
}

/* LOGIN */
function logIn() {
  var email = document.getElementById("loginEmail").value;
  var password = document.getElementById("loginPassword").value;

  auth.signInWithEmailAndPassword(email, password)
    .catch(function(error){
      alert(error.message);
    });
}

/* START CHAT */
function startChat() {

  var friendId = "friendUserId"; 
  var chatRoomId = [currentUser.uid, friendId].sort().join("-");
  chatRef = database.ref("chats/" + chatRoomId + "/messages");

  chatRef.off();
  document.getElementById("chatDisplay").innerHTML = "";

  chatRef.on("child_added", function(snapshot){
    displayMessage(snapshot.val());
  });
}

/* SEND MESSAGE */
function sendMessage() {
  var textInput = document.getElementById("textInput");
  var text = textInput.value;
  if (!text) return;

  chatRef.push({
    user: currentUser.email,
    text: text,
    timestamp: Date.now()
  });

  textInput.value = "";
}

/* DISPLAY MESSAGE */
function displayMessage(msg) {
  var chatDisplay = document.getElementById("chatDisplay");
  var msgDiv = document.createElement("div");

  if (msg.user === currentUser.email) {
    msgDiv.className = "chat-box user1";
  } else {
    msgDiv.className = "chat-box user2";
  }

  msgDiv.innerHTML = msg.text;
  chatDisplay.appendChild(msgDiv);
  chatDisplay.scrollTop = chatDisplay.scrollHeight;
}
</script>

</body>
      </html>
